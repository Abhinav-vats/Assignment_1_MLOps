# Use the official Python image from the Docker Hub
FROM python:3.8-slim

# Set the working directory
WORKDIR /app

# Copy the current directory contents into the container at /app
COPY . /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    git \
    && rm -rf /var/lib/apt/lists/*

# Install the dependencies
RUN pip install --no-cache-dir -r requirements.txt

# ENV GDRIVE_SERVICE_ACCOUNT_JSON='ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibWxvcHMtYXNzaWdubWVudC1ncm91cC02NCIsCiAgInByaXZhdGVfa2V5X2lkIjogImY2YTcxZmFkYTAzMDMzNmYwOWZhN2NmZjFhZWQzMWQ0NWM3YjM1MzciLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRFI0VXUrMVAxZTMrbXpcbjBvQk94TU10L1lycElSVndhZW0zdGhMeE5aS3JHeDA5bHBKQVVKSmp1VkZMejMrL0x3eW04TS92TlhGT3k1T2Zcbi80enV6N294czN5MEFycGtIMUpzS2tXdXhpQ0JPNXBleHRiQnliQm45ZkdxWjIrcUFLdG9rNzZSS0dYNkpHTDNcbjF1MVQ2UnFydzhYeFNzcG1mbFEvbWRzTktvK2Z6QWhSNUtnTC9qY1R3UnBxbnpPYVl1NEp3QkY3QjkyZjBwdzhcbmpiZkpudCtidFp4SnJZdFhsTzV5ZXp2Ulh2cXVjdGhVc2swcllvTlNqck9waXVwNEFycGY4QmppQWpZeWJCcVBcbmV3eEJUdkM5RGhoV3dHUE5oZWh0ZThMRm9DS0FyM01aakh1YXpNR2c1bnVDZEtWa1h2UnNNT21yYUpDSUNBMzNcbkljRDEyNFFGQWdNQkFBRUNnZ0VBQ1hnOTM2MWloVDViSUJiMlhSZDVxd0NPblBnMkxHMUs4MVFPeEwxakViOVdcbmNXbnl6VjRWVE5TV3UzSHdWS0w5MGlaNWExU2crU29zVGdMTXpCV3BWQWJDTUtrUzJlT2o1MmQ4MzJibkhvMmVcbjZIbldSTVloNUg3dldYM3pSdHRpNElRU0RDQ2pnVWJWQkZPNVA1ajc4QllVUDAvZGxBUk5MdFYxVWNIQzJ6WFhcbmxjTTNxOENScE1sdTlCSkdhU0NUY2VRK1NxekVnYUZXV0Uyc0ZDZjVYcDhXVVpiVDZZaFM1NnhzWVd0QVQyNnpcbm94WWVDSGc5ZkM4WG9Ld3dmdUx3cldHK2xiVzRDTlJZODFXb1JsVVE2eDRlVWlRRnBaQ09CODVFRFoxL1VsN1pcbis1clJTY1NVbjluV29HaGo0Ty9YSlJiZnRTcnBjL3hGNGVJZFQxYWdnUUtCZ1FEeXNVbmh1aVBYbC93cytxRXZcblp4V2pHU0xDVkNFSnNsWERxSW10NEdMS0c0V3IvYzVFTTBKeTlLL29nSFZwTVZHOXBpdlJPK09USzRpbU5mVFlcbnRwMFJtOXltRE13eHMwSGZzMjh0dVNGa3RlaENvQ3dQMEQ0K0hZVWhSdXYyTlc3S3FuZysvalJMS2tDUFBBQUZcbmpjWDVYRUZKN2M2WnhTUTRSU0FpMWpBRDVRS0JnUURkWTJub3gyWnFjcFh3cnYrZW5TN3hOV0dreCt5eS9ycS9cbnJRakVhQ1hnSHBRY043QU5NVW16VlAxR0s2RjV0VkNnb1dNbXlFRUttNENvY0pKckxoaTdoay9oV1V3SGtPRXVcbktTR2lHcUhMWW1UU3FTRjJaU2JOVi8wNUFwaGpYZG5kSGp4cW5sYWg0dW1WS1FUVkRaaTJ3dUlpejNmNUc1RFNcblRpKyt1Ulc5b1FLQmdRRGlGSXZKenJmeTcrK0lDeFk2YldJM3BJTy8yZFZKRGl0YzhGVUplQjB2UDRJL25Wa1lcbktWUStlSGlpTTRDc3RMZjczcCswODRCbHFjbExaTG9wWTd4Z0dmenJac0tWamZMUXJIdm1jUzZOZmZQV2xSVldcbnlkd2h5eWdvdnNPemdVVXJZTEJScGtjYXVrcVg1QUgxS29RQmJwS1hod1BPTlZzdlhCMjZ0aUxXalFLQmdRQ2tcblkrV0l6RWZvVXgyemtyNk04UHFpY1prSDJzeVFQVVkrZmlZOGNYbHVha1pnalpsVXNueWZoVVJzam9sZzdwbm9cbkxPNkxKYmZtUUlIUWtZYW52NXJ0NUZYOFoycGxVOWRoaDNsSi9heVdjWUdjUzZwbFY4YndRNTNzYjFqb3NBL09cbmVWMHpiaysxOWVDc3VjQzAwMXZLbWZ1QkRiMXdaRit0U2hGNTljV0hBUUtCZ0V5R1YyRWxWeWJ6UGxRQ05qa1dcblBGODZFakY2TGJ6eW5aMXJKcWpXeWRzbEpWUGtDOWR5aEE0Qm00QTZsVGk5WncxMmw2dXlZY0ZmN1cyZ1B1MVRcbnV4bG9FakFteFJVUTJKamk5ZGxEekFyZFluZ0dmRWQ4T3BzVGw2YWNta2U4UG04ZVd1L3RIeTVRVms2WWlDVmNcbnozV29OQUsydXIxMVIyQUtMWkkxTEVOTlxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogImFzc2lnbm1lbnQtdjFAbWxvcHMtYXNzaWdubWVudC1ncm91cC02NC5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMDAwOTY3MjQ5NzA0MzA4NjQ3NTIiLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2Fzc2lnbm1lbnQtdjElNDBtbG9wcy1hc3NpZ25tZW50LWdyb3VwLTY0LmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAidW5pdmVyc2VfZG9tYWluIjogImdvb2dsZWFwaXMuY29tIgp9Cg=='
# Expose port 5005 for the Flask app and port 5000 for MLflow
EXPOSE 5005
EXPOSE 5000

# Run the train_model.py script
CMD ["python", "/app/src/train_model.py"]
